## 1. 数据库设计与实现
- [x] 1.1 添加 PostgreSQL 客户端依赖到 package.json
- [x] 1.2 创建数据库 schema 迁移脚本
  - [x] 1.2.1 创建 available_proxies 表
  - [x] 1.2.2 创建 deprecated_proxies 表
  - [x] 1.2.3 添加索引优化查询性能
- [x] 1.3 实现数据库连接管理模块 (`api/database/connection.ts`)
- [x] 1.4 实现数据访问层 (DAO)
  - [x] 1.4.1 可用代理 DAO (`api/database/available-proxies-dao.ts`)
  - [x] 1.4.2 废弃代理 DAO (`api/database/deprecated-proxies-dao.ts`)
- [x] 1.5 编写数据库单元测试

## 2. 代理管理逻辑改造
- [x] 2.1 修改 `proxy-manager.ts` 支持数据库模式
- [x] 2.2 实现启动时从代理池加载 IP 并存入数据库
- [x] 2.3 实现代理失败次数递增逻辑
- [x] 2.4 实现超过 10 次失败自动移入废弃表
- [x] 2.5 实现基于权重的代理选择算法
- [x] 2.6 实现可用代理 < 5 个时自动补充逻辑
- [x] 2.7 实现获取新代理时过滤废弃表中的 IP

## 3. 代理测试逻辑增强
- [x] 3.1 修改 `proxy-tester.ts` 集成数据库
- [x] 3.2 实现使用前可达性检测
- [x] 3.3 实现不可达代理直接移入废弃表
- [x] 3.4 实现不可达时重新选取代理逻辑

## 4. 多代理回退机制
- [x] 4.1 实现每次请求选取 5 个代理的逻辑
- [x] 4.2 实现依次回退尝试机制
- [x] 4.3 修改 `request-handler.ts` 支持多代理回退

## 5. 自动清理机制
- [x] 5.1 实现废弃 IP 30 天后自动删除的定时任务
- [x] 5.2 配置定时任务执行频率

## 6. 配置与环境变量
- [x] 6.1 在 `config.ts` 中添加数据库配置
- [x] 6.2 添加 DATABASE_URL 环境变量支持
- [x] 6.3 添加数据库相关配置项（阈值、超时等）
- [x] 6.4 更新 .env.example 文件

## 7. 兼容性处理
- [x] 7.1 实现向后兼容逻辑（未配置 DATABASE_URL 时使用内存模式）
- [x] 7.2 添加模式切换逻辑

## 8. 测试与验证
- [x] 8.1 编写集成测试
- [x] 8.2 测试数据库 CRUD 操作
- [x] 8.3 测试代理生命周期管理
- [x] 8.4 测试多代理回退机制
- [x] 8.5 测试自动清理机制
- [x] 8.6 测试兼容性（内存模式）
- [x] 8.7 运行所有测试确保通过

## 9. 文档更新
- [x] 9.1 更新 README.md 添加数据库配置说明
- [x] 9.2 更新 ARCHITECTURE.md 添加数据库架构图
- [x] 9.3 添加数据库迁移指南

## 10. 部署准备
- [x] 10.1 准备数据库迁移脚本
- [x] 10.2 更新 Vercel 环境变量文档
- [x] 10.3 验证部署流程